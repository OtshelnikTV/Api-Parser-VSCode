<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Doc Parser</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- Theme Toggle Button -->
<button id="theme-toggle" class="theme-toggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üå∏</button>

<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay hidden">
    <div class="loading-spinner"></div>
    <div id="loading-text" class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="loading-progress" class="loading-progress"></div>
</div>

<!-- STEP 1: Project Selection -->
<div id="setup-project" class="modal-overlay">
    <div class="modal">
        <div class="step-indicator">
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
            <div class="step-dot"></div>
        </div>
        <span class="modal-icon">üìÅ</span>
        <h2>–®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</h2>
        <p>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –±–µ—Ä—ë—Ç—Å—è –∏–∑ <code>redocly.yaml</code> –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.</p>
        
        <!-- Project List -->
        <div id="project-list-container" style="margin-bottom:16px;">
            <h3 style="color:#8b949e; font-size:14px; margin-bottom:10px;">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:</h3>
            <div class="project-list" id="project-list"></div>
            <div class="file-count" id="project-file-count"></div>
        </div>
        
        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px">
            <button class="btn btn-primary btn-lg" id="btn-save-project" disabled>–î–∞–ª–µ–µ ‚Üí</button>
        </div>
    </div>
</div>

<!-- STEP 2: Request Selection -->
<div id="setup-request" class="modal-overlay hidden">
    <div class="modal" style="max-width:700px;">
        <div class="step-indicator">
            <div class="step-dot done"></div>
            <div class="step-dot active"></div>
            <div class="step-dot"></div>
        </div>
        <span class="modal-icon">üîç</span>
        <h2>–®–∞–≥ 2: –í—ã–±–æ—Ä –∑–∞–ø—Ä–æ—Å–∞</h2>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ endpoint –∏–∑ —Å–ø–∏—Å–∫–∞.</p>
        
        <input type="text" class="search-input" id="request-search" placeholder="üîç –ü–æ–∏—Å–∫...">
        <div class="request-list" id="request-list"></div>
        
        <div style="display:flex;gap:10px;justify-content:space-between;margin-top:16px;flex-wrap:wrap;">
            <button class="btn" id="btn-back-to-project">‚Üê –°–º–µ–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
            <button class="btn btn-primary btn-lg" id="btn-next-method" disabled>–î–∞–ª–µ–µ ‚Üí</button>
        </div>
    </div>
</div>

<!-- STEP 3: Method Selection -->
<div id="setup-method" class="modal-overlay hidden">
    <div class="modal" style="max-width:600px;">
        <div class="step-indicator">
            <div class="step-dot done"></div>
            <div class="step-dot done"></div>
            <div class="step-dot active"></div>
        </div>
        <span class="modal-icon">üéØ</span>
        <h2>–®–∞–≥ 3: –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞</h2>
        <p>Endpoint <code id="selected-endpoint-name"></code> –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π:</p>
        
        <div id="method-selector" style="display:flex;gap:12px;flex-wrap:wrap;padding:20px;justify-content:center;"></div>
        
        <div style="display:flex;gap:10px;justify-content:space-between;margin-top:24px;">
            <button class="btn" id="btn-back-to-requests">‚Üê –ö —Å–ø–∏—Å–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤</button>
            <button class="btn btn-primary btn-lg" id="btn-parse" disabled>üöÄ –ü–∞—Ä—Å–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- EDITOR -->
<div id="main-editor" class="app-container hidden">
    <div class="header">
        <h1>üìã API Doc Parser</h1>
        <div class="header-actions">
            <button class="btn" id="btn-editor-back-to-requests">üìÇ –î—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å</button>
            <button class="btn" id="btn-editor-back-to-project">‚öôÔ∏è –°–º–µ–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
        </div>
    </div>
    
    <div class="status-bar">
        <div class="status-dot"></div>
        <span id="status-text">–ó–∞–≥—Ä—É–∂–µ–Ω–æ</span>
        <span class="status-path" id="status-path"></span>
    </div>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color auto"></div>
            <span>–ê–≤—Ç–æ (–∏–∑ YAML)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color manual"></div>
            <span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</span>
        </div>
        <div class="legend-item">
            <div class="legend-color required"></div>
            <span>–ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é</span>
        </div>
    </div>
    
    <div id="editor-content"></div>
    
    <div class="generate-panel">
        <div class="generate-info">
            –ù–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö: <span id="unfilled-count">0</span>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button class="btn btn-blue btn-lg" id="btn-preview-markdown">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
            <button class="btn btn-primary btn-lg" id="btn-generate-save">üìÑ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å read.md</button>
        </div>
    </div>
</div>

<!-- PREVIEW MODAL -->
<div id="preview-modal" class="modal-overlay hidden" style="align-items:stretch;">
    <div style="background:#161b22;border:1px solid #30363d;border-radius:16px;margin:24px;flex:1;display:flex;flex-direction:column;overflow:hidden;">
        <div style="padding:16px 24px;border-bottom:1px solid #30363d;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
            <h2 style="color:#58a6ff;font-size:18px;">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä read.md</h2>
            <div style="display:flex;gap:10px;">
                <button class="btn btn-primary" id="btn-preview-save">üìÑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn" id="btn-close-preview">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
        <div style="flex:1;overflow:auto;padding:24px;">
            <pre id="preview-content" style="font-family:'Cascadia Code','Fira Code','Consolas',monospace;font-size:13px;line-height:1.5;white-space:pre-wrap;color:#c9d1d9;"></pre>
        </div>
    </div>
</div>
<script src="js/lib/mermaid.min.js" 
        onerror="console.error('failed to load mermaid.min.js');" 
        onload="console.log('mermaid.min.js loaded');"></script>
<script>
    // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è mermaid –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–µ—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤–∞, –ø–æ–≤—Ç–æ—Ä–∏–º –ø–æ–∑–∂–µ)
    function initMermaid() {
        console.log('initMermaid called, window.mermaid=', window.mermaid);
        if (window.mermaid && typeof mermaid.initialize === 'function') {
            console.log('mermaid available, initializing');
            mermaid.initialize({ 
                startOnLoad: false,
                theme: 'dark',
                themeVariables: {
                    darkMode: true,
                    background: '#0d1117',
                    primaryColor: '#58a6ff',
                    primaryTextColor: '#c9d1d9',
                    primaryBorderColor: '#30363d',
                    lineColor: '#8b949e',
                    secondaryColor: '#21262d',
                    tertiaryColor: '#161b22'
                }
            });
        } else {
            // –µ—Å–ª–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–∑–∂–µ
            setTimeout(initMermaid, 200);
        }
    }
    initMermaid();
</script>
<script type="module" src="js/app.js"></script>
</body>
</html>
